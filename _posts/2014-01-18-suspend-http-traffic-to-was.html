---
layout: post
title: "How to suspend HTTP traffic to a WebSphere Application Server"
category: tech
tags:
 - WebSphere
image: /2014/01/18/screenshot.png
blogger: /2014/01/suspend-http-traffic-to-was.html
disqus: true
description: >
 Learn how to use the WebContainer MBean to temporarily suspend HTTP traffic to a WebSphere Application Server instance.
---

<p>
One of the annoying things with the WebSphere plug-in for IBM HTTP Server is that there is no straightforward way to suspend traffic to a given application server. The problem is that the plug-in is not aware of the runtime weights of the members in a WebSphere cluster. The only way to suspend HTTP traffic to a given server is to set the configured weight of the cluster member to zero and then to regenerate and propagate the plug-in configuration file. The plug-in will automatically reread that file and stop sending HTTP requests to the server. Alternatively, one can also edit the <code>plugin-cfg.xml</code> file manually to temporarily set the <code>LoadBalanceWeight</code> to zero.
</p>
<p>
Obviously this method is cumbersome, especially compared to how this kind of operation is done on other load balancers. On the other hand, one of the advantages of the WebSphere plug-in is that it able to detect a stopped member and fail over the connections without loosing requests: as soon as it detects that the HTTP port on the WebSphere server is closed, it will redirect requests (including the request that caused the attempt to establish the connection to the application server) to other cluster members. Therefore another approach would be to instruct the application server to (temporarily) close its HTTP port(s) in order to force the WebSphere plug-in to route requests to other members.
</p>
<p>
It turns out that this is indeed possible. Each application server has an MBean of type <code>WebContainer</code> with operations <code>stopTransports</code> and <code>startTransports</code>. The first operation stops all HTTP transports and closes the corresponding ports, i.e. <code>WC_defaulthost</code> and <code>WC_defaulthost_secure</code> (as well as <code>WC_adminhost</code> and <code>WC_adminhost_secure</code> on stand-alone servers and deployment managers). The second operation restores normal operation.
</p>
<img src="screenshot.png" />
<p>
As noted in <a href="http://www-01.ibm.com/support/docview.wss?uid=swg1PK96239">PK96239</a>, the <code>WebContainer</code> MBean was deprecated in WAS 6.1 and has been replaced by the <code>TransportChannelService</code> MBean. However, the latter is much more difficult to use and as of WAS 8.5.5, the <code>WebContainer</code> MBean is still supported. Therefore using the <code>WebContainer</code> MBean remains the preferred method to do this.
</p>
<p>
It should also be noted that using the <code>stopTransports</code> to suspend HTTP traffic to a WebSphere server may have some drawbacks in certain situations. The most important one is that since the HTTP ports are closed, it is no longer possible to send any kind of HTTP request to the server. In particular it is no longer possible to send test requests directly to the server. One should also be careful if there are applications deployed on the server that may send HTTP requests to the server itself (via <code>localhost</code>) in response to requests received via protocols other than HTTP, such as IIOP (remote EJB calls) or JMS.
</p>
